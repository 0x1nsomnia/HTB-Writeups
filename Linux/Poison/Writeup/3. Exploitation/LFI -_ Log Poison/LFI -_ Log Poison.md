Although log poisoning is uneccessary at this point since we discovered SSH credentials for user `Charix`, we can assume the intended way to get foothold on this machine is through log poisoning -- hence the name "Poison". 

With LFI we are able to view the Apache access log. Since Apache is logging strings of data from requests to the server, we can inject our own php code in the User-Agent as this is user controlled.

*Normal log*
![apache-log-normal.png](../../../_resources/apache-log-normal.png)


*Injecting php in User-Agent*
![inject-UA-phpinfo.png](../../../_resources/inject-UA-phpinfo.png)

*Poisoned log*
![apache-log-poisoned.png](../../../_resources/apache-log-poisoned.png)

After confirming log poisoning is possible, we can then simply inject our PHP web shell. I prefix the User-Agent with `0x` to make it easier to search/grep in the logs for the output.

*Injecting web shell*
![inject-UA-web-shell.png](../../../_resources/inject-UA-web-shell.png)



![working-webshell.png](../../../_resources/working-webshell.png)

For some extra learning and playing around, we can also take this one step further with a reverse shell. We can test by pinging our attack box from the victim box.


![webshell-ping.png](../../../_resources/webshell-ping.png)



We got our ICMP echo reply!
![ping-back.png](../../../_resources/ping-back.png)


Using the OpenBSD nc shell from [HighOn.Coffee](https://highon.coffee/blog/reverse-shell-cheat-sheet/) we can commence the shell...
![reverse-shell-uri.png](../../../_resources/reverse-shell-uri.png)


And we are now `www`!
![working-reverse-shell.png](../../../_resources/working-reverse-shell.png)

For extra credit, we will lastly upgrade our shell
Reference: [https://zweilosec.github.io/posts/upgrade-linux-shell/](https://zweilosec.github.io/posts/upgrade-linux-shell/)

My regular method of using python doesn't work since there is not python on this box! Nor is there perl, ruby or lua. The most simple TTY shell I could come up with was just by invoking `csh`  which seems to be the primary shell used for FreeBSD from the short bit of reading I did.



![upgrade-shell.png](../../../_resources/upgrade-shell.png)

It also seems like setting the TERM variable or stty columns/rows did not work which I can only assume is a wacky FreeBSD thing... Anyway, this doesn't really matter since I won't be using this shell as `www` when I can just ssh as `Charix`. 






